{% extends "base.html" %} {% block content %}
<div class="row">
  <div class="col-12">
    <h1 class="mb-4">
      <i class="fas fa-code me-2"></i>
      API 문서
    </h1>
    <p class="lead">이메일 증거 처리 시스템의 RESTful API 문서입니다.</p>
  </div>
</div>

<div class="row">
  <div class="col-md-3">
    <div class="list-group" id="api-nav">
      <a
        class="list-group-item list-group-item-action active"
        href="#emails-api"
      >
        <i class="fas fa-envelope me-2"></i>이메일 API
      </a>
      <a class="list-group-item list-group-item-action" href="#evidence-api">
        <i class="fas fa-gavel me-2"></i>증거 API
      </a>
      <a class="list-group-item list-group-item-action" href="#timeline-api">
        <i class="fas fa-timeline me-2"></i>타임라인 API
      </a>
      <a class="list-group-item list-group-item-action" href="#system-api">
        <i class="fas fa-cog me-2"></i>시스템 API
      </a>
    </div>
  </div>

  <div class="col-md-9">
    <!-- 이메일 API -->
    <div id="emails-api" class="api-section">
      <h3><i class="fas fa-envelope me-2"></i>이메일 API</h3>

      <div class="card mb-3">
        <div class="card-header">
          <span class="badge bg-success me-2">POST</span>
          <code>/api/emails/load</code>
        </div>
        <div class="card-body">
          <h6>이메일 파일 로드</h6>
          <p>mbox 파일을 로드하여 이메일 데이터를 처리합니다.</p>

          <h6>요청 예시:</h6>
          <pre><code>{
  "filename": "emails.mbox"
}</code></pre>

          <h6>응답 예시:</h6>
          <pre><code>{
  "success": true,
  "message": "이메일 로드 완료",
  "total_emails": 150,
  "filtered_emails": 120
}</code></pre>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-header">
          <span class="badge bg-primary me-2">GET</span>
          <code>/api/emails/search</code>
        </div>
        <div class="card-body">
          <h6>이메일 검색</h6>
          <p>키워드로 이메일을 검색합니다.</p>

          <h6>파라미터:</h6>
          <ul>
            <li><code>query</code> - 검색 키워드</li>
            <li><code>sender</code> - 발신자 필터</li>
            <li><code>date_from</code> - 시작 날짜 (YYYY-MM-DD)</li>
            <li><code>date_to</code> - 종료 날짜 (YYYY-MM-DD)</li>
          </ul>

          <h6>응답 예시:</h6>
          <pre><code>{
  "success": true,
  "results": [
    {
      "id": "email_001",
      "subject": "계약서 관련",
      "sender": "example@company.com",
      "date": "2024-01-15",
      "has_attachments": true
    }
  ],
  "total": 1
}</code></pre>
        </div>
      </div>
    </div>

    <!-- 증거 API -->
    <div id="evidence-api" class="api-section" style="display: none">
      <h3><i class="fas fa-gavel me-2"></i>증거 API</h3>

      <div class="card mb-3">
        <div class="card-header">
          <span class="badge bg-primary me-2">GET</span>
          <code>/api/evidence</code>
        </div>
        <div class="card-body">
          <h6>증거 목록 조회</h6>
          <p>생성된 증거 문서 목록을 조회합니다.</p>

          <h6>응답 예시:</h6>
          <pre><code>{
  "success": true,
  "evidence_list": [
    {
      "id": "evidence_001",
      "evidence_number": "갑 제1호증",
      "title": "이메일 증거",
      "created_date": "2024-01-15",
      "file_path": "/evidence/갑제1호증.pdf"
    }
  ]
}</code></pre>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-header">
          <span class="badge bg-success me-2">POST</span>
          <code>/api/evidence/generate</code>
        </div>
        <div class="card-body">
          <h6>증거 생성</h6>
          <p>선택된 이메일들로 법정 증거 문서를 생성합니다.</p>

          <h6>요청 예시:</h6>
          <pre><code>{
  "email_ids": ["email_001", "email_002"],
  "evidence_type": "email_batch",
  "party": "갑"
}</code></pre>
        </div>
      </div>
    </div>

    <!-- 타임라인 API -->
    <div id="timeline-api" class="api-section" style="display: none">
      <h3><i class="fas fa-timeline me-2"></i>타임라인 API</h3>

      <div class="card mb-3">
        <div class="card-header">
          <span class="badge bg-primary me-2">GET</span>
          <code>/api/timeline</code>
        </div>
        <div class="card-body">
          <h6>타임라인 생성</h6>
          <p>이메일 송수신 타임라인을 생성합니다.</p>

          <h6>파라미터:</h6>
          <ul>
            <li><code>format</code> - 출력 형식 (json, html, csv)</li>
            <li><code>date_from</code> - 시작 날짜</li>
            <li><code>date_to</code> - 종료 날짜</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- 시스템 API -->
    <div id="system-api" class="api-section" style="display: none">
      <h3><i class="fas fa-cog me-2"></i>시스템 API</h3>

      <div class="card mb-3">
        <div class="card-header">
          <span class="badge bg-primary me-2">GET</span>
          <code>/api/system/disk-usage</code>
        </div>
        <div class="card-body">
          <h6>디스크 사용량 조회</h6>
          <p>시스템의 디스크 사용량을 확인합니다.</p>
        </div>
      </div>

      <div class="card mb-3">
        <div class="card-header">
          <span class="badge bg-warning me-2">POST</span>
          <code>/api/system/cleanup</code>
        </div>
        <div class="card-body">
          <h6>시스템 정리</h6>
          <p>임시 파일 및 캐시를 정리합니다.</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-5">
  <div class="col-12">
    <div class="card bg-light">
      <div class="card-body">
        <h5><i class="fas fa-info-circle me-2"></i>API 사용 안내</h5>
        <ul>
          <li>
            <strong>Base URL:</strong> <code>http://localhost:5000/api</code>
          </li>
          <li><strong>Content-Type:</strong> <code>application/json</code></li>
          <li><strong>인증:</strong> 현재 인증 없음 (개발 환경)</li>
          <li>
            <strong>오류 코드:</strong> HTTP 상태 코드 사용 (200, 400, 404, 500)
          </li>
        </ul>

        <h6 class="mt-3">테스트 도구</h6>
        <p>아래 버튼을 클릭하여 API를 테스트해볼 수 있습니다:</p>
        <button
          class="btn btn-primary btn-sm me-2"
          onclick="testAPI('/api/emails/statistics')"
        >
          <i class="fas fa-play me-1"></i>이메일 통계 테스트
        </button>
        <button
          class="btn btn-success btn-sm me-2"
          onclick="testAPI('/api/system/disk-usage')"
        >
          <i class="fas fa-play me-1"></i>디스크 사용량 테스트
        </button>
      </div>
    </div>
  </div>

  <!-- 관리자 링크 섹션 -->
  <div class="container mt-4">
    <div class="row">
      <div class="col-12 text-center">
        <a href="/admin" class="btn btn-warning">
          <i class="fas fa-cog me-1"></i>시스템 관리
        </a>
        <a href="/" class="btn btn-secondary ms-2">
          <i class="fas fa-home me-1"></i>홈으로
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  // API 네비게이션
  document.querySelectorAll("#api-nav a").forEach((link) => {
    link.addEventListener("click", function (e) {
      e.preventDefault();

      // 모든 섹션 숨기기
      document.querySelectorAll(".api-section").forEach((section) => {
        section.style.display = "none";
      });

      // 모든 링크에서 active 제거
      document.querySelectorAll("#api-nav a").forEach((a) => {
        a.classList.remove("active");
      });

      // 선택된 섹션 보이기
      const targetId = this.getAttribute("href").substring(1);
      document.getElementById(targetId).style.display = "block";

      // 선택된 링크에 active 추가
      this.classList.add("active");
    });
  });

  // API 테스트 함수
  function testAPI(endpoint) {
    fetch(endpoint)
      .then((response) => response.json())
      .then((data) => {
        alert(`API 테스트 결과:\n${JSON.stringify(data, null, 2)}`);
      })
      .catch((error) => {
        alert(`API 테스트 오류: ${error.message}`);
      });
  }
</script>
{% endblock %}
